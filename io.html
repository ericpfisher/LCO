<!DOCTYPE html>
<html>
<head>
	<title>I/O</title>
	<link type="text/css" rel="stylesheet" href="css/reset.css"/>
	<style>
		body {
			background: #2ecd7e;
			font-family: 'Helvetica Neue', Helvetica, Verdana, sans-serif;
			text-align: center;
		}

		div.iopost {
			margin: 15px;
			padding: 20px;
			border: 2px solid #969696;
			border-radius: 3px
		}

		div.iopost:after {
			content: " ";
			display: block;
			height: 0;
			clear: both;
		}

		p.posttext {
			float: left;
			margin-left: 10px;
			cursor: pointer;
			font-size: 1em;
		}

		div.rightside {
			float: right;
			display: inline-block;
		}

		p.closepost{
			transition: color 0.5s;
			-webkit-transition: color 0.5s;
			cursor: pointer;
			font-size: 1em;
			font-weight: bold;
		}

		p.closepost:hover {
			color: #3296ff;
		}

		.postnotes {
			border: none;
			overflow: auto;
			outline: none;
			resize: none;

			box-shadow: none;
			-webkit-box-shadow: none;
			-moz-box-shadow: none;

			border-top: 2px solid #3296ff;
			margin-top: 15px;
			padding-top: 10px;
			width: 100%;
			height: 50px;

			font-size: 0.8em;
		}

		.techname, .user, .inorouttext, .needpwtext, .ticket {
			font-weight: bold;
		}

		#mainwrap {
			width: 1000px;
			height: 100%;
			background: #fff;
			position: absolute;
			left: 50%;
			margin-left: -500px;
			z-index: 1;
			box-shadow: 10px 0 100px #777, -10px 0 100px #777; 
		}

		#mainheader {
			font-size: 3em;
			margin-bottom: 30px;
		}

		#filterposts {
			width: 30%;
		}
	</style>
	<script src="js/jquery-1.10.2.min.js"></script>
	<script>
	$(document).ready(function() {

		function postData(element, tech, user, ticket, inorout, notes, needpws) {
			var inorouttext = null;
			var needpwtext = null;
			if (inorout==1) {
				inorouttext = "drop off";
			} else if (inorout==0) {
				inorouttext = "pick up";
			} else {
				inorouttext = "got NULL from the database!";
			}

			if (needpws==1) {
				needpwtext = "and password(s)";
			} else {
				needpwtext = "";
			}
			$(element).append("<div id='"+ticket+"' class='iopost'><div class='picwrapper'></div><div class='summarywrap'><p class='posttext'><span class='techname'>"+tech+"</span> is expecting <span class='user'>"+user+"</span> to <span class='inorouttext'>"+inorouttext+"</span> their computer <span class='needpwtext'>"+needpwtext+"</span> for <span class='ticket'>"+ticket+"</span>.<div class='rightside'><p class='closepost' id="+ticket+">DONE</p></div></p></div><div class='noteswrap'><textarea class='postnotes' style='display:none'>"+notes+"</textarea></div></div>");
		}; // end postData declaration

		var tech_names = null;

		$.ajax({
			type: "POST",
			url: "./internal/io/getnames.php",
			async: false,
			dataType: "json",
			success: function(data) {
				tech_names = data;
			}
		});

		$.ajax({
			type: "POST",
			url: "./internal/io/showio.php",
			dataType: "json",
			success: function(data) {
				if (data.length > 0) {
					$.each(data, function(index, post_data) {
						var username = post_data.tech;
						for (var i = 0, length = tech_names.length; i < length; i++) {
							if (username == tech_names[i]["username"]) {
								username = tech_names[i]["first"];
								break;
							}
						}
						postData("#mainwrap", username, post_data.user, post_data.inc, post_data.inorout, post_data.notes, post_data.needpws);
					});
				} else {
					$("#mainwrap").append("<p>No Posts</p>");
				}
			}
		});

		$(document).on("click", ".closepost", function() {
			var thispost = $(this).attr("id");
			$.ajax({
				type: "POST",
				data: {inc: thispost},
				url: "./internal/io/deactivate.php",
				success: function(data) {
					if(data=="success") {
						$("#"+thispost).fadeOut(400);
					}
				}
			});
		});

		$(document).on("click", ".posttext", function() {
			if ($(this).parent().siblings(".noteswrap").children(".postnotes").css("display") != "none") {
				$(this).parent().siblings(".noteswrap").children(".postnotes").hide();
				return false;
			} else {
				$(".postnotes").hide();
			}
			$(this).parent().siblings(".noteswrap").children(".postnotes").fadeIn(400);
		});

		$(document).on("keyup", "#filterposts", function() {
			var parameters = $(this).val().toLowerCase();
			if (parameters.length < 2) {
				$(".iopost").each(function() {
					if ($(this).css("display")=="none") $(this).fadeIn(400);
				});
			} else {
				$(".iopost").each(function() {
					var innertext = $(this).text().toLowerCase();
			
					if (innertext.indexOf(parameters) < 0) {
						$(this).fadeOut(400);
					} else if ((innertext.indexOf(parameters) > -1) && ($(this).css("display")=="none")) {
						$(this).fadeIn(400);
					}
				});
			}
		}); // end keyup listener
	}); // end ready
</script>
</head>
<body>
<div id="mainwrap">
	<h1 id="mainheader">I/O</h1>
	<input type="text" name="filterposts" id="filterposts" placeholder="Filter posts by INC, user, technician, etc." />
</div>
</body>
</html>